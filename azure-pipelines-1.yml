# Node.js with Angular
# Build a Node.js project that uses Angular.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger:
- master

pool:
  vmImage: ubuntu-latest

variables:
  projectDirectory: 'Client'

steps:
- task: NodeTool@0
  displayName: 'Install Node.js'
  inputs:
    versionSpec: '10.x'

- task: Npm@1
  displayName: 'Install Angular CLI'
  inputs:
    command: 'custom'
    customCommand: 'install -g @angular/cli'
- task: Npm@1
  displayName: Run NPM install
  inputs:
    command: 'install'
    workingDir: $(projectDirectory)

- task: CmdLine@2
  inputs:
    script: 'ng build --prod'
    workingDirectory: $(projectDirectory)
- task: AzureRmWebAppDeployment@4
  inputs:
    ConnectionType: 'AzureRM'
    azureSubscription: 'leconfield-software(af4597b8-06f3-421c-b812-b8bf6057a731)'
    appType: 'webApp'
    WebAppName: 'augustus-api'
    VirtualApplication: '\ui'
    packageForLinux: '$(System.DefaultWorkingDirectory)/Client/dist'
